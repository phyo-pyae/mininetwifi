#!/usr/bin/env python3
"""
Continuous WiFi Signal Strength Monitor
Run this in a separate terminal while simulation is running
"""

import subprocess
import time
import re

def get_signal_strength():
    """Get signal strength from iwconfig for all interfaces"""
    
    try:
        result = subprocess.run(['iwconfig'], capture_output=True, text=True)
        output = result.stdout
        
        print("\n" + "="*70)
        print(f"WiFi Signal Strength - {time.strftime('%H:%M:%S')}")
        print("="*70)
        
        # Parse iwconfig output
        interfaces = output.split('\n\n')
        
        for interface in interfaces:
            if 'Signal level' in interface or 'Link Quality' in interface:
                lines = interface.split('\n')
                
                # Extract interface name
                iface_name = lines[0].split()[0]
                
                # Extract signal level
                for line in lines:
                    if 'Signal level' in line:
                        # Extract dBm value
                        match = re.search(r'Signal level[=:]?\s*(-\d+)\s*dBm', line)
                        if match:
                            dbm = match.group(1)
                            
                            # Determine quality
                            dbm_int = int(dbm)
                            if dbm_int > -70:
                                quality = "STRONG ✓✓✓"
                            elif dbm_int > -80:
                                quality = "GOOD  ✓✓"
                            elif dbm_int > -90:
                                quality = "FAIR  ✓"
                            else:
                                quality = "WEAK  ✗"
                            
                            print(f"{iface_name:20s}: {dbm:6s} dBm  [{quality}]")
                    
                    elif 'Link Quality' in line:
                        match = re.search(r'Link Quality[=:]?\s*(\d+)/(\d+)', line)
                        if match:
                            quality_val = int(match.group(1))
                            quality_max = int(match.group(2))
                            percentage = (quality_val / quality_max) * 100
                            print(f"{iface_name:20s}: {percentage:.1f}% quality")
        
        print("="*70 + "\n")
        
    except Exception as e:
        print(f"Error reading signal strength: {e}\n")


def main():
    """Monitor signal strength continuously"""
    
    print("\n*** WiFi Signal Strength Monitor ***")
    print("Updates every 2 seconds. Press Ctrl+C to stop.\n")
    
    try:
        while True:
            get_signal_strength()
            time.sleep(2)
    except KeyboardInterrupt:
        print("\nMonitor stopped.")


if __name__ == '__main__':
    main()